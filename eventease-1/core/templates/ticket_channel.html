<!-- filepath: e:\Projects\EventEase\core\templates\ticket_channel.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Channel - {{ event.event_name }}</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <h1>Ticket Channel for {{ event.event_name }}</h1>
    <h2>Your Role: {{ role }}</h2>
    <h3>Phone: {{ phone }}</h3>

    <div id="tickets">
        <h3>Tickets</h3>
        <ul>
            {% for ticket in tickets %}
                <li>
                    <strong>{{ ticket.sender }}:</strong> {{ ticket.text }} 
                    <em>({{ ticket.timestamp }})</em>
                    {% if role == 'admin' %}
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="respond_ticket_id" value="{{ forloop.counter0 }}">
                            <input type="text" name="response" placeholder="Response">
                            <button type="submit">Respond</button>
                        </form>
                        <ul>
                            {% for response in ticket.responses %}
                                <li><strong>Admin:</strong> {{ response.text }} <em>({{ response.timestamp }})</em></li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>

    <div id="new-ticket">
        <h3>Create a New Ticket</h3>
        <form method="POST">
            {% csrf_token %}
            <textarea name="ticket" placeholder="Describe your issue or request..." required></textarea>
            <button type="submit">Submit Ticket</button>
        </form>
    </div>

    <footer>
        <a href="{% url 'event_dashboard' event.event_id %}">Back to Event Dashboard</a>
    </footer>
</body>
</html>